@page "/cv"
@using Markdig

<PageTitle>CV | Samet Can Cıncık</PageTitle>

<MudContainer MaxWidth="MaxWidth.Medium">
    <BackToHome />

    <article class="mt-4">
        @if (string.IsNullOrWhiteSpace(_htmlContent))
        {
            <MudSkeleton Width="100%" Height="60px" Animation="Animation.Wave" Class="mb-6" />
            <MudSkeleton Width="100%" Height="150px" Animation="Animation.Wave" Class="mb-6" />
            <MudSkeleton Width="80%" Height="100px" Animation="Animation.Wave" Class="mb-6" />
        }
        else
        {
            <MudHtmlRenderer HtmlContent="@_htmlContent" />
        }
    </article>

    @if (!string.IsNullOrWhiteSpace(_htmlContent))
    {
        <MudStack Row Justify="Justify.FlexEnd" Spacing="2" Class="mt-4 mb-4 d-print-none">
            <MudButton Variant="Variant.Outlined" Color="Color.Primary"
                       StartIcon="@Icons.Material.Filled.Print"
                       OnClick="@(() => PrintPage())"
                       Style="text-transform: none;"
                       data-umami-event="cv-print-button-click">
                Print
            </MudButton>
        </MudStack>
    }
</MudContainer>

@code {
    [Inject] private IWebHostEnvironment Env { get; set; } = default!;
    [Inject] private IJSRuntime JS { get; set; } = default!;

    private string _htmlContent = string.Empty;

    protected override async Task OnInitializedAsync()
    {
        var path = Path.Combine(Env.ContentRootPath, "content", "cv.mdx");
        if (File.Exists(path))
        {
            var markdown = await File.ReadAllTextAsync(path);
            var pipeline = new Markdig.MarkdownPipelineBuilder()
                .UseAdvancedExtensions()
                .Build();
            _htmlContent = Markdig.Markdown.ToHtml(markdown, pipeline);
        }
    }

    private async Task PrintPage()
    {
        await JS.InvokeVoidAsync("print");
    }
}
