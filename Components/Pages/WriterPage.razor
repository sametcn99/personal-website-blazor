@page "/writer"
@rendermode InteractiveServer
@using Markdig

<PageTitle>Writer | Samet Can Cıncık</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large" Class="py-4" Style="height: calc(100vh - 80px);">
    <MudStack Class="h-100" Spacing="0">
        @* Toolbar *@
        <MudStack Row AlignItems="AlignItems.Center" Spacing="2" Class="mb-2">
            <MudText Typo="Typo.h6" Style="font-weight: 600;">Writer</MudText>
            <MudSpacer />
            <MudToggleIconButton @bind-Toggled="_isPreview"
                                 Icon="@Icons.Material.Filled.Visibility"
                                 ToggledIcon="@Icons.Material.Filled.Edit"
                           Size="Size.Small"
                           data-umami-event="writer-toolbar-toggle-preview-click" />
            <MudIconButton Icon="@Icons.Material.Filled.Delete" Size="Size.Small"
                       OnClick="ClearContent"
                       data-umami-event="writer-toolbar-clear-click" />
        </MudStack>

        <MudDivider Class="mb-2" />

        @if (_isPreview)
        {
            <MudPaper Elevation="0" Class="pa-4 flex-grow-1 overflow-auto" Style="border: 1px solid var(--mud-palette-divider); border-radius: 4px;">
                <MudHtmlRenderer HtmlContent="@RenderedHtml" />
            </MudPaper>
        }
        else
        {
            <MudTextField T="string" @bind-Value="_content" Lines="30"
                          Variant="Variant.Outlined" Placeholder="Start writing in Markdown..."
                          Style="font-family: monospace; flex-grow: 1;"
                          FullWidth Class="flex-grow-1" />
        }
    </MudStack>
</MudContainer>

@code {
    private string _content = string.Empty;
    private bool _isPreview;

    private string RenderedHtml
    {
        get
        {
            if (string.IsNullOrWhiteSpace(_content)) return "<p>Nothing to preview.</p>";
            var pipeline = new Markdig.MarkdownPipelineBuilder()
                .UseAdvancedExtensions()
                .Build();
            return Markdig.Markdown.ToHtml(_content, pipeline);
        }
    }

    private void ClearContent() => _content = string.Empty;
}
